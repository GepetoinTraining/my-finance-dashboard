// This is your Prisma schema file.
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider                      = "prisma-client-py"
  output                        = "../src/lib/prisma_client"
  recursive_type_depth        = -1
  enable_experimental_decimal = true
  // ADD THIS LINE: This tells Prisma to download the Vercel-compatible binary
  // and include its path in the generated client.py file.
  binaryTargets               = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// === EXISTING MODELS ===

// Replicates your 'ingestion_logs' table
model IngestionLogs {
  id        Int      @id @default(autoincrement())
  job_id    String   @db.Uuid
  log_type  String   @db.VarChar(50)
  message   String   @db.Text
  timestamp DateTime @default(now()) @db.Timestamp(6)

  @@map("ingestion_logs")
}

// Replicates your 'bank_transactions' table
model BankTransactions {
  id               Int       @id @default(autoincrement())
  transaction_date DateTime? @db.Date
  posting_date     DateTime? @db.Date
  type             String    @db.VarChar(10)
  amount_decimal   Decimal   @db.Decimal(12, 2)
  raw_history_text String    @db.Text
  raw_value_text   String?   @db.Text
  raw_balance_text String?   @db.Text
  source_file_name String    @db.VarChar(255)
  raw_json_data    Json?     @db.Json
  created_at       DateTime  @default(now()) @db.Timestamp(6)

  @@map("bank_transactions")
}

// === NEW MODELS FOR INTERNAL REPORTS ===

// Model for novembro-pagamentos.pdf
model InternalPayments {
  id                Int       @id @default(autoincrement())
  category          String?   @map("categoria")
  entity_name       String?   @map("entidade_nome")
  entity_type       String?   @map("entidade_tipo")
  installment       String?   @map("parcela")
  issue_date        DateTime? @db.Date @map("emissao")
  due_date          DateTime? @db.Date @map("vencimento")
  full_amount       Decimal?  @db.Decimal(12, 2) @map("valor_integral")
  discount_amount   Decimal?  @db.Decimal(12, 2) @map("valor_com_desconto")
  updated_amount    Decimal?  @db.Decimal(12, 2) @map("valor_atualizado")
  paid_amount       Decimal?  @db.Decimal(12, 2) @map("valor_pago")
  notes             String?   @map("observacao")
  status            String?   @map("status")
  source_file_name  String    @db.VarChar(255)
  created_at        DateTime  @default(now()) @db.Timestamp(6)

  @@map("internal_payments")
}

// Model for novembro-recebimentos.pdf
model InternalReceivables {
  id                  Int       @id @default(autoincrement())
  category            String?   @map("categoria")
  entity_name         String?   @map("entidade_nome")
  entity_type         String?   @map("entidade_tipo")
  phone               String?   @map("telefone")
  financial_responsible String?   @map("responsavel_financeiro")
  installment         String?   @map("parcela")
  issue_date          DateTime? @db.Date @map("emissao")
  due_date            DateTime? @db.Date @map("vencimento")
  full_amount         Decimal?  @db.Decimal(12, 2) @map("valor_integral")
  discount_amount     Decimal?  @db.Decimal(12, 2) @map("valor_com_desconto")
  updated_amount      Decimal?  @db.Decimal(12, 2) @map("valor_atualizado")
  paid_amount         Decimal?  @db.Decimal(12, 2) @map("valor_pago")
  notes               String?   @map("observacao")
  status              String?   @map("status")
  contract_status     String?   @map("status_do_contrato")
  source_file_name    String    @db.VarChar(255)
  created_at          DateTime  @default(now()) @db.Timestamp(6)

  @@map("internal_receivables")
}